import 'dart:io';

import 'package:x509b/src/verification.dart';
import 'package:x509b/x509.dart';

void main() async {
  var cert = '''-----BEGIN CERTIFICATE-----
MIIFUjCCBDqgAwIBAgIQTA+Q5sovgUsKMswEMkKqFjANBgkqhkiG9w0BAQsFADBG
MQswCQYDVQQGEwJVUzEiMCAGA1UEChMZR29vZ2xlIFRydXN0IFNlcnZpY2VzIExM
QzETMBEGA1UEAxMKR1RTIENBIDFENDAeFw0yMjA5MjQxMzIwMzNaFw0yMjEyMjMx
MzIwMzJaMBIxEDAOBgNVBAMTB3B1Yi5kZXYwggEiMA0GCSqGSIb3DQEBAQUAA4IB
DwAwggEKAoIBAQCXI+wKY+G0fldLDGPsmyiYo4w14RFjJxKKxQZx1nEc7Hdiltjc
sAYRSrvdtGC06X5BCKlBDtp1EmCSav4OyvMKmxeFw0TO7+ujLyjqS5MHxqVmtMhF
aKO/2Y2pVRqj2Z1wtcdi4zbCKUBZuelmGGxXUYtSt67qfX7XYX6BA8qeGTQSVkGS
dBDWw1NXXqSZYwMngqwGMq6aRSphEAxhU1F5xI4oFSsfNUtwzlrjuYX1lrOv5UuJ
nS27hqsjJ8nkYKn8NG+ttTjFlVKAgdHEe/6Y382baJA4q/AieSE59JStuFGDLqp8
1eU6B6qV+x2mGMiZeAvLJcGvm+3w0meiQps5AgMBAAGjggJuMIICajAOBgNVHQ8B
Af8EBAMCBaAwEwYDVR0lBAwwCgYIKwYBBQUHAwEwDAYDVR0TAQH/BAIwADAdBgNV
HQ4EFgQUVetLGhGoO6C2GPJhJDRdKppCYJ8wHwYDVR0jBBgwFoAUJeIYDrJXkZQq
5dRdhpCD3lOzuJIweAYIKwYBBQUHAQEEbDBqMDUGCCsGAQUFBzABhilodHRwOi8v
b2NzcC5wa2kuZ29vZy9zL2d0czFkNC8tYmxqb19FeWt5NDAxBggrBgEFBQcwAoYl
aHR0cDovL3BraS5nb29nL3JlcG8vY2VydHMvZ3RzMWQ0LmRlcjASBgNVHREECzAJ
ggdwdWIuZGV2MCEGA1UdIAQaMBgwCAYGZ4EMAQIBMAwGCisGAQQB1nkCBQMwPAYD
VR0fBDUwMzAxoC+gLYYraHR0cDovL2NybHMucGtpLmdvb2cvZ3RzMWQ0L3FxeGU2
cDNCajdJLmNybDCCAQQGCisGAQQB1nkCBAIEgfUEgfIA8AB3AEalVet1+pEgMLWi
iWn0830RLEF0vv1JuIWr8vxw/m1HAAABg2/rcNIAAAQDAEgwRgIhALZ/qztjz6aY
BewbrmOiOCrWCuQWwDqVwM0aaWjNki48AiEA84Y7VNs980/+EnzM5TX2WA4C8Zdo
j0RhcvUgI2PDzyMAdQAFnAHTIOAHhBOVgEmNEXyQMmavr3JQta87RqQ+EYQNSgAA
AYNv63DeAAAEAwBGMEQCIGClMAjeHz+GG5mdNbNdpHf/E9/yKnjJ+7CXaarjKD0h
AiB+LAekvxRLvsD7EYrcVVhbbbAUyTgl4npxcf/BVxfsSDANBgkqhkiG9w0BAQsF
AAOCAQEAq0sCniKPpz1L7z3J87JXpddDMBfD4K+pUJ2wk0fZRuVwR1NBADMd/LT8
zUuLat4K2cIqDs2Lnt7kPLCO/ybWV44/EwrGHAKb5LqWdk6aIlEN03yjKM0sCqY9
bki9vtIfNoTehAcWJSDPiTA/WV6RC1FOG9QhBBun9ic6rZrUsgxF1BwoJUs8wUeZ
dZCIKkccdpNDyIZQIkvoa1pkMYlP7xqkdkWdvQxJ1MgqZl8wZJKH7RQJBhivuCXO
jhPh/o9LMRtpVnNHNDWZOs5Id+ZyQC5b0wFoJrsj8K9rObtfFZUdz7JRO+/4ROQ7
Hb4ePahCRqXjg78H2AVPklVCeDd9Ww==
-----END CERTIFICATE-----
''';
  var v = parsePem(cert).first as X509Certificate;

  var issuer = '''-----BEGIN CERTIFICATE-----
MIIFjDCCA3SgAwIBAgINAgCOsgIzNmWLZM3bmzANBgkqhkiG9w0BAQsFADBHMQsw
CQYDVQQGEwJVUzEiMCAGA1UEChMZR29vZ2xlIFRydXN0IFNlcnZpY2VzIExMQzEU
MBIGA1UEAxMLR1RTIFJvb3QgUjEwHhcNMjAwODEzMDAwMDQyWhcNMjcwOTMwMDAw
MDQyWjBGMQswCQYDVQQGEwJVUzEiMCAGA1UEChMZR29vZ2xlIFRydXN0IFNlcnZp
Y2VzIExMQzETMBEGA1UEAxMKR1RTIENBIDFENDCCASIwDQYJKoZIhvcNAQEBBQAD
ggEPADCCAQoCggEBAKvAqqPCE27l0w9zC8dTPIE89bA+xTmDaG7y7VfQ4c+mOWhl
UebUQpK0yv2r678RJExK0HWDjeq+nLIHN1Em5j6rARZixmyRSjhIR0KOQPGBMUld
saztIIJ7O0g/82qj/vGDl//3t4tTqxiRhLQnTLXJdeB+2DhkdU6IIgx6wN7E5NcU
H3Rcsejcqj8p5Sj19vBm6i1FhqLGymhMFroWVUGO3xtIH91dsgy4eFKcfKVLWK3o
2190Q0Lm/SiKmLbRJ5Au4y1euFJm2JM9eB84Fkqa3ivrXWUeVtye0CQdKvsY2Fka
zvxtxvusLJzLWYHk55zcRAacDA2SeEtBbQfD1qsCAwEAAaOCAXYwggFyMA4GA1Ud
DwEB/wQEAwIBhjAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwEgYDVR0T
AQH/BAgwBgEB/wIBADAdBgNVHQ4EFgQUJeIYDrJXkZQq5dRdhpCD3lOzuJIwHwYD
VR0jBBgwFoAU5K8rJnEaK0gnhS9SZizv8IkTcT4waAYIKwYBBQUHAQEEXDBaMCYG
CCsGAQUFBzABhhpodHRwOi8vb2NzcC5wa2kuZ29vZy9ndHNyMTAwBggrBgEFBQcw
AoYkaHR0cDovL3BraS5nb29nL3JlcG8vY2VydHMvZ3RzcjEuZGVyMDQGA1UdHwQt
MCswKaAnoCWGI2h0dHA6Ly9jcmwucGtpLmdvb2cvZ3RzcjEvZ3RzcjEuY3JsME0G
A1UdIARGMEQwCAYGZ4EMAQIBMDgGCisGAQQB1nkCBQMwKjAoBggrBgEFBQcCARYc
aHR0cHM6Ly9wa2kuZ29vZy9yZXBvc2l0b3J5LzANBgkqhkiG9w0BAQsFAAOCAgEA
IVToy24jwXUr0rAPc924vuSVbKQuYw3nLflLfLh5AYWEeVl/Du18QAWUMdcJ6o/q
FZbhXkBH0PNcw97thaf2BeoDYY9Ck/b+UGluhx06zd4EBf7H9P84nnrwpR+4GBDZ
K+Xh3I0tqJy2rgOqNDflr5IMQ8ZTWA3yltakzSBKZ6XpF0PpqyCRvp/NCGv2KX2T
uPCJvscp1/m2pVTtyBjYPRQ+QuCQGAJKjtN7R5DFrfTqMWvYgVlpCJBkwlu7+7KY
3cTIfzE7cmALskMKNLuDz+RzCcsYTsVaU7Vp3xL60OYhqFkuAOOxDZ6pHOj9+OJm
YgPmOT4X3+7L51fXJyRH9KfLRP6nT31D5nmsGAOgZ26/8T9hsBW1uo9ju5fZLZXV
VS5H0HyIBMEKyGMIPhFWrlt/hFS28N1zaKI0ZBGD3gYgDLbiDT9fGXstpk+Fmc4o
lVlWPzXe81vdoEnFbr5M272HdgJWo+WhT9BYM0Ji+wdVmnRffXgloEoluTNcWzc4
1dFpgJu8fF3LG0gl2ibSYiCi9a6hvU0TppjJyIWXhkJTcMJlPrWx1VytEUGrX2l0
JDwRjW/656r0KVB02xHRKvm2ZKI03TglLIpmVCK3kBKkKNpBNkFt8rhafcCKOb9J
x/9tpNFlQTl7B39rJlJWkR17QnZqVptFePFORoZmFzM=
-----END CERTIFICATE-----
''';
  var issuerCert = parsePem(issuer).first as X509Certificate;
  var rootPem = '''-----BEGIN CERTIFICATE-----
MIIFVzCCAz+gAwIBAgINAgPlk28xsBNJiGuiFzANBgkqhkiG9w0BAQwFADBHMQsw
CQYDVQQGEwJVUzEiMCAGA1UEChMZR29vZ2xlIFRydXN0IFNlcnZpY2VzIExMQzEU
MBIGA1UEAxMLR1RTIFJvb3QgUjEwHhcNMTYwNjIyMDAwMDAwWhcNMzYwNjIyMDAw
MDAwWjBHMQswCQYDVQQGEwJVUzEiMCAGA1UEChMZR29vZ2xlIFRydXN0IFNlcnZp
Y2VzIExMQzEUMBIGA1UEAxMLR1RTIFJvb3QgUjEwggIiMA0GCSqGSIb3DQEBAQUA
A4ICDwAwggIKAoICAQC2EQKLHuOhd5s73L+UPreVp0A8of2C+X0yBoJx9vaMf/vo
27xqLpeXo4xL+Sv2sfnOhB2x+cWX3u+58qPpvBKJXqeqUqv4IyfLpLGcY9vXmX7w
Cl7raKb0xlpHDU0QM+NOsROjyBhsS+z8CZDfnWQpJSMHobTSPS5g4M/SCYe7zUjw
TcLCeoiKu7rPWRnWr4+wB7CeMfGCwcDfLqZtbBkOtdh+JhpFAz2weaSUKK0Pfybl
qAj+lug8aJRT7oM6iCsVlgmy4HqMLnXWnOunVmSPlk9orj2XwoSPwLxAwAtcvfaH
szVsrBhQf4TgTM2S0yDpM7xSma8ytSmzJSq0SPly4cpk9+aCEI3oncKKiPo4Zor8
Y/kB+Xj9e1x3+naH+uzfsQ55lVe0vSbv1gHR6xYKu44LtcXFilWr06zqkUspzBmk
MiVOKvFlRNACzqrOSbTqn3yDsEB750Orp2yjj32JgfpMpf/VjsPOS+C12LOORc92
wO1AK/1TD7Cn1TsNsYqiA94xrcx36m97PtbfkSIS5r762DL8EGMUUXLeXdYWk70p
aDPvOmbsB4om3xPXV2V4J95eSRQAogB/mqghtqmxlbCluQ0WEdrHbEg8QOB+DVrN
VjzRlwW5y0vtOUucxD/SVRNuJLDWcfr0wbrM7Rv1/oFB2ACYPTrIrnqYNxgFlQID
AQABo0IwQDAOBgNVHQ8BAf8EBAMCAYYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4E
FgQU5K8rJnEaK0gnhS9SZizv8IkTcT4wDQYJKoZIhvcNAQEMBQADggIBAJ+qQibb
C5u+/x6Wki4+omVKapi6Ist9wTrYggoGxval3sBOh2Z5ofmmWJyq+bXmYOfg6LEe
QkEzCzc9zolwFcq1JKjPa7XSQCGYzyI0zzvFIoTgxQ6KfF2I5DUkzps+GlQebtuy
h6f88/qBVRRiClmpIgUxPoLW7ttXNLwzldMXG+gnoot7TiYaelpkttGsN/H9oPM4
7HLwEXWdyzRSjeZ2axfG34arJ45JK3VmgRAhpuo+9K4l/3wV3s6MJT/KYnAK9y8J
ZgfIPxz88NtFMN9iiMG1D53Dn0reWVlHxYciNuaCp+0KueIHoI17eko8cdLiA6Ef
MgfdG+RCzgwARWGAtQsgWSl4vflVy2PFPEz0tv/bal8xa5meLMFrUKTX5hgUvYU/
Z6tGn6D/Qqc6f1zLXbBwHSs09dR2CQzreExZBfMzQsNhFRAbd03OIozUhfJFfbdT
6u9AWpQKXCBfTkBdYiJ23//OYb2MI3jSNwLgjt7RETeJ9r/tSQdirpLsQBqvFAnZ
0E6yove+7u7Y/9waLd64NnHi/Hm3lCXRSHNboTXns5lndcEZOitHTtNCjv0xyBZm
2tIMPNuzjsmhDYAPexZ3FL//2wmUspO8IFgV6dtxQ/PeEMMA3KgqlbbC1j+Qa3bb
bP6MvPJwNQzcmRk13NfIRmPVNnGuV/u3gm3c
-----END CERTIFICATE-----
''';
  var rootCert = parsePem(rootPem).first as X509Certificate;
  var base64 =
      'MIIFUjCCBDqgAwIBAgIQTA+Q5sovgUsKMswEMkKqFjANBgkqhkiG9w0BAQsFADBGMQswCQYDVQQGEwJVUzEiMCAGA1UEChMZR29vZ2xlIFRydXN0IFNlcnZpY2VzIExMQzETMBEGA1UEAxMKR1RTIENBIDFENDAeFw0yMjA5MjQxMzIwMzNaFw0yMjEyMjMxMzIwMzJaMBIxEDAOBgNVBAMTB3B1Yi5kZXYwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCXI+wKY+G0fldLDGPsmyiYo4w14RFjJxKKxQZx1nEc7HdiltjcsAYRSrvdtGC06X5BCKlBDtp1EmCSav4OyvMKmxeFw0TO7+ujLyjqS5MHxqVmtMhFaKO/2Y2pVRqj2Z1wtcdi4zbCKUBZuelmGGxXUYtSt67qfX7XYX6BA8qeGTQSVkGSdBDWw1NXXqSZYwMngqwGMq6aRSphEAxhU1F5xI4oFSsfNUtwzlrjuYX1lrOv5UuJnS27hqsjJ8nkYKn8NG+ttTjFlVKAgdHEe/6Y382baJA4q/AieSE59JStuFGDLqp81eU6B6qV+x2mGMiZeAvLJcGvm+3w0meiQps5AgMBAAGjggJuMIICajAOBgNVHQ8BAf8EBAMCBaAwEwYDVR0lBAwwCgYIKwYBBQUHAwEwDAYDVR0TAQH/BAIwADAdBgNVHQ4EFgQUVetLGhGoO6C2GPJhJDRdKppCYJ8wHwYDVR0jBBgwFoAUJeIYDrJXkZQq5dRdhpCD3lOzuJIweAYIKwYBBQUHAQEEbDBqMDUGCCsGAQUFBzABhilodHRwOi8vb2NzcC5wa2kuZ29vZy9zL2d0czFkNC8tYmxqb19FeWt5NDAxBggrBgEFBQcwAoYlaHR0cDovL3BraS5nb29nL3JlcG8vY2VydHMvZ3RzMWQ0LmRlcjASBgNVHREECzAJggdwdWIuZGV2MCEGA1UdIAQaMBgwCAYGZ4EMAQIBMAwGCisGAQQB1nkCBQMwPAYDVR0fBDUwMzAxoC+gLYYraHR0cDovL2NybHMucGtpLmdvb2cvZ3RzMWQ0L3FxeGU2cDNCajdJLmNybDCCAQQGCisGAQQB1nkCBAIEgfUEgfIA8AB3AEalVet1+pEgMLWiiWn0830RLEF0vv1JuIWr8vxw/m1HAAABg2/rcNIAAAQDAEgwRgIhALZ/qztjz6aYBewbrmOiOCrWCuQWwDqVwM0aaWjNki48AiEA84Y7VNs980/+EnzM5TX2WA4C8Zdoj0RhcvUgI2PDzyMAdQAFnAHTIOAHhBOVgEmNEXyQMmavr3JQta87RqQ+EYQNSgAAAYNv63DeAAAEAwBGMEQCIGClMAjeHz+GG5mdNbNdpHf/E9/yKnjJ+7CXaarjKD0hAiB+LAekvxRLvsD7EYrcVVhbbbAUyTgl4npxcf/BVxfsSDANBgkqhkiG9w0BAQsFAAOCAQEAq0sCniKPpz1L7z3J87JXpddDMBfD4K+pUJ2wk0fZRuVwR1NBADMd/LT8zUuLat4K2cIqDs2Lnt7kPLCO/ybWV44/EwrGHAKb5LqWdk6aIlEN03yjKM0sCqY9bki9vtIfNoTehAcWJSDPiTA/WV6RC1FOG9QhBBun9ic6rZrUsgxF1BwoJUs8wUeZdZCIKkccdpNDyIZQIkvoa1pkMYlP7xqkdkWdvQxJ1MgqZl8wZJKH7RQJBhivuCXOjhPh/o9LMRtpVnNHNDWZOs5Id+ZyQC5b0wFoJrsj8K9rObtfFZUdz7JRO+/4ROQ7Hb4ePahCRqXjg78H2AVPklVCeDd9Ww==';

  //print(toHexString(toBigInt(base64Decode(base64))));
  //print(v.toAsn1());
  //print(base64Encode(v.toAsn1().encodedBytes));
  //print(v.signatureAlgorithm);

  var chain = await buildCertificateChain(v, [rootCert]);
  print(await verifyCertificateChain(chain));

  //print(v.tbsCertificate.extensions);

  //print('verification:');
  print(await verifyCertificate(v, issuerCert));

  var certChain = File(
      '/home/sarah/certificateAuth/testCerts/pub-dev-zertifikatskette.pem');
  var asCerts =
      parsePem(certChain.readAsStringSync()).toList().cast<X509Certificate>();
  print(asCerts);
  print(await verifyCertificateChain(asCerts.reversed.toList()));
}
